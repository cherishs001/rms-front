!function(e){function t(t){for(var n,i,o=t[0],l=t[1],c=t[2],u=0,p=[];u<o.length;u++)i=o[u],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&p.push(s[i][0]),s[i]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(m&&m(t);p.length;)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],n=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=a[0]))}return e}var n={},s={0:0},r=[];function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=n,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(a,n,function(t){return e[t]}.bind(null,n));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="https://rms.kaishens.cn/";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var m=l;r.push([209,1]),a()}({143:function(e,t,a){e.exports={text:"OvGE4HupMlkgboZfEqa-A"}},181:function(e,t,a){e.exports={pageContainer:"_3LMLu1y0hubTsnZFfP_55m"}},209:function(e,t,a){a(210),e.exports=a(430)},210:function(e,t){e.exports='<!doctype html> <html lang=zh-cn> <head> <title></title> <meta charset=UTF-8> <meta http-equiv=X-UA-Compatible content="IE=edge"> <style>#dashboard,body,html{position:relative;width:100%;height:100%;margin:0;overflow-x:hidden;overflow-y:hidden;-webkit-overflow-scrolling:touch;padding:0;-webkit-text-size-adjust:100%!important;text-size-adjust:100%!important;-moz-text-size-adjust:100%!important;font-family:"Microsoft YaHei UI","Segoe UI","Helvetica Neue","Lucida Grande",Roboto,Ebrima,"Nirmala UI",Gadugi,"Segoe Xbox Symbol","Segoe UI Symbol","Meiryo UI","Khmer UI",Tunga,"Lao UI",Raavi,"Iskoola Pota",Latha,Leelawadee,"Microsoft JhengHei UI","Malgun Gothic","Estrangelo Edessa","Microsoft Himalaya","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Tai Le","Microsoft Yi Baiti","Mongolian Baiti","MV Boli","Myanmar Text","Cambria Math",serif}.ant-menu-sub{background-color:#141414!important}.ant-menu-item-active{background-color:#262626!important}.ant-menu-item-selected{background-color:#434343!important}.language-javascript{margin-right:8px}.language-javascript::-webkit-scrollbar{height:4px}.language-javascript::-webkit-scrollbar-thumb{background-color:#262626}</style> </head> <body> <div id=dashboard></div> </body> </html> '},25:function(e,t,a){e.exports={outer:"_3bmkPBHJw7FtL4KFAgYh9",middle:"SrMxNwLpqozAX8uFK__0b",inner:"_3b3iGQ3-lcZHnig19fqS8o",title:"J6zOG_0cNqhfhbfLQyC6V",titleContainer:"_3KoU7kkgXMAFRzyBEAY4ev",titleDescribe:"_1Dp4i2gUlIW9I0P5UeN5yT",chooseAccount:"_1-IWl5HD2cbgYHwc1GcFof",prompt:"vFxGaNJjSIzjhycjNA652",button:"_2VtZD6MO0Szv8h8MNAXD23"}},430:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a(21),r=a.n(s),i=a(139),o=a(14),l=a(33),c=(a(231),a(434)),m=a(85),u=a.n(m),p=a(181),h=a.n(p),d=a(1),g=a.n(d);var f=e=>{const t=e.style||{},a=g()(h.a.pageContainer,e.className);return n.createElement("div",{className:a,style:{...t}},e.children)},y=a.p+"5bab73933468015fb37792389e0dba6b.svg";const{withRouterConnect:E}=r.a;class b extends n.PureComponent{render(){return n.createElement("div",null,"Overview")}}var k=E(b),v=a(202),_=(a(179),a(146)),C=(a(151),a(19)),w=(a(88),a(207)),S=(a(257),a(38)),x=(a(152),a(65)),N=(a(153),a(48)),L=a.n(N),I=a(204),F=(a(264),a(23)),R=(a(431),a(37)),M=(a(150),a(118)),P=(a(271),a(119)),T=(a(274),a(64)),j=(a(149),a(145)),O=(a(277),a(35)),V=a.n(O),A=a(182);const B="https://api.kaishens.cn",D=e=>{if(1e3===e.status)return e.data.token&&window.localStorage.setItem("token",e.data.token),{...e.data};throw{apiInfo:e.message}},q=e=>{403===e&&window.location.replace("/login")};V.a.interceptors.response.use(e=>new Promise((t,a)=>{e.status&&200===e.status&&"error"===e.data.status?a({message:e.data.message}):t(e)}),e=>(403===e.response.status&&window.location.replace("/login"),Promise.resolve(e)));const K=async(e,t,a,n)=>{const s=await V.a.post(B+"/api/disable",{is_enabled:a?1:0,api_id:n},{headers:{token:e,uid:t}});return D(s.data)},U=async(e,t,a)=>{const n=await V.a.get(`${B}/api/doc?api_id=${a}`,{headers:{token:e,uid:t}});return q(n.status),D(n.data)};var z=a(86),G=a.n(z),H=a(183),J=a.n(H),W=(a(298),a(117)),Y=a.n(W);G.a.registerLanguage("javascript",J.a),Y.a.setOptions({renderer:new Y.a.Renderer,highlight:e=>(G.a.highlight,G.a.highlightAuto(e).value),pedantic:!1,gfm:!0,tables:!0,breaks:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1});class Z extends n.PureComponent{constructor(e){super(e),this.mark=n.createRef()}renderCode(){return this.props.code?Y()(this.props.code):""}componentDidUpdate(e,t){if(this.mark.current){const e=this.mark.current.getElementsByTagName("pre");for(let t=0;t<e.length;t++){const a=e[t].getElementsByTagName("code");for(let e=0;e<a.length;e++)G.a.highlightBlock(a[e])}}}componentDidMount(){if(this.mark.current){const e=this.mark.current.getElementsByTagName("pre");for(let t=0;t<e.length;t++){const a=e[t].getElementsByTagName("code");for(let e=0;e<a.length;e++)G.a.highlightBlock(a[e])}}}render(){return n.createElement("div",{className:this.props.className,dangerouslySetInnerHTML:{__html:this.renderCode()},ref:this.mark})}}var X=Z,Q=a(143),$=a.n(Q),ee=a(79);class te extends n.PureComponent{constructor(){super(...arguments),this.state={value:this.props.value||""},this.codeEdit=n.createRef()}onChange(e){this.props.onChange&&this.props.onChange(e)}render(){let e=$.a.text;return this.props.className&&(e=`${$.a.text} ${this.props.className}`),n.createElement("textarea",{className:e,value:this.state.value,onChange:e=>{const t=e.currentTarget.value;this.setState({value:t},()=>{Object(ee.a)(100,this.onChange(t))})},onKeyDown:e=>{if(9===e.keyCode){e.preventDefault();const t=e.currentTarget.selectionStart,a=this.state.value,n=a.substr(0,t)+"  "+a.substr(t);this.setState({value:n},()=>{this.codeEdit.current.selectionStart=this.codeEdit.current.selectionEnd=t+2})}},spellCheck:"false",autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",ref:this.codeEdit})}}var ae=te,ne=a.p+"8f69c40761b4bcbac8e0ef31554ffa06.svg",se=a.p+"cbb6a290634f5c564592bd8d088c0ad0.svg",re=a.p+"8eafac34192cc5abc52f71f65807f228.svg";const{connect:ie}=r.a,{Option:oe}=R.a,{TabPane:le}=j.a;class ce extends n.PureComponent{constructor(e){super(e),this.state={visible:!1,createApiConfigLoading:!1,limitFormConfig:0,editMarkdown:!1,doc:"",initDoc:""},this.form=n.createRef(),this.form2=n.createRef(),this.token=this.props.state.global.token,this.uid=this.props.state.global.user_id,this.form2_value={rate_limit:0,token_rate:1e4,token_sum:2e4}}componentDidMount(){U(this.token,this.uid,this.props.api_id).then(e=>{this.setState({doc:e.doc,initDoc:e.doc})})}render(){return n.createElement(n.Fragment,null,n.createElement("div",{className:this.props.className,style:{...this.props.style},onClick:()=>{this.setState({visible:!0},()=>{"edit"===this.props.type&&(async(e,t,a)=>{const n=await V.a.get(`${B}/api/config?api_id=${a}`,{headers:{token:e,uid:t}});return D(n.data)})(this.token,this.uid,this.props.api_id).then(e=>{this.form2_value={rate_limit:e.rate_limit,token_rate:e.token_rate,token_sum:e.token_sum},this.form.current&&this.form.current.setFieldsValue(e),this.setState({limitFormConfig:e.rate_limit},()=>{this.form2.current&&this.form2.current.setFieldsValue(this.form2_value)})}).catch(()=>S.a.error("获取单个接口配置信息失败"))})}},this.props.children),n.createElement(I.a,{visible:this.state.visible,okText:"确认",cancelText:"取消",bodyStyle:{height:593},okButtonProps:{loading:this.state.createApiConfigLoading},onOk:()=>{this.setState({createApiConfigLoading:!0}),this.form.current&&this.form.current.submit()},onCancel:()=>{this.setState({visible:!1},()=>{this.form.current&&this.form.current.resetFields(),this.form2.current&&this.form2.current.resetFields()})}},n.createElement(j.a,{defaultActiveKey:"1",tabBarStyle:{marginBottom:20}},n.createElement(le,{tab:"基础信息",key:"1",forceRender:!0},n.createElement(F.a,{labelCol:{span:4},wrapperCol:{span:18},onValuesChange:()=>{},onFinish:()=>{const e=this.props.state.global.token,t=this.props.state.global.user_id,a={};if(this.form.current){const n=this.form.current.getFieldsValue();if(a.name=n.name,a.tag=n.tag,a.protocol=n.protocol,a.host=n.host,a.port=n.port,a.method=n.method,a.prefix=n.prefix,a.upstream=n.upstream,a.is_enabled=n.is_enabled,a.auth_type=n.auth_type,this.form2.current){const e=this.form2.current.getFieldsValue();a.rate_limit=e.rate_limit,a.token_rate=e.token_rate,a.token_sum=e.token_sum}"create"===this.props.type&&(async(e,t,a)=>{const n=await V.a.post(B+"/api/create",{...a},{headers:{token:e,uid:t}});return D(n.data)})(e,t,a).then(()=>{S.a.success("新建接口配置成功"),this.setState({createApiConfigLoading:!1,visible:!1},()=>{this.form.current&&this.form.current.resetFields(),this.props.onSuccess&&this.props.onSuccess()})}).catch(()=>{S.a.success("新建接口配置失败"),this.setState({createApiConfigLoading:!1})}),"edit"===this.props.type&&(a.api_id=this.props.api_id,(async(e,t,a)=>{const n=await V.a.post(B+"/api/update",{...a},{headers:{token:e,uid:t}});return D(n.data)})(e,t,a).then(()=>{S.a.success("更新接口配置成功"),this.setState({createApiConfigLoading:!1,visible:!1},()=>{this.form.current&&this.form.current.resetFields(),this.props.onSuccess&&this.props.onSuccess()})}).catch(()=>{S.a.success("更新接口配置失败"),this.setState({createApiConfigLoading:!1})}))}},onFinishFailed:()=>{this.setState({createApiConfigLoading:!1})},ref:this.form},n.createElement(F.a.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入接口名称！"}]},n.createElement(x.a,{autoComplete:"off",placeholder:"请输入接口名称",spellCheck:"false"})),n.createElement(F.a.Item,{label:"分类",name:"tag",rules:[{required:!0,message:"请设置接口分类！"}]},n.createElement(x.a,{autoComplete:"off",placeholder:"请设置接口分类",spellCheck:"false"})),n.createElement(F.a.Item,{label:"对外路由",name:"prefix",rules:[{required:!0,message:"请输入接口对外路由！"}]},n.createElement(x.a,{autoComplete:"off",placeholder:"请输入接口对外路由",spellCheck:"false"})),n.createElement(F.a.Item,{label:"是否启用",name:"is_enabled",rules:[{required:!0,message:"请设置此接口是否启用！"}],initialValue:0},n.createElement(T.a.Group,null,n.createElement(T.a,{value:0},"禁用"),n.createElement(T.a,{value:1},"启用"))),n.createElement(M.a,{orientation:"left"},"上游服务信息"),n.createElement(F.a.Item,{label:"协议类型",name:"protocol",rules:[{required:!0,message:"请输入上游服务协议类型！"}],initialValue:"http"},n.createElement(R.a,null,n.createElement(oe,{value:"https"},"HTTPS"),n.createElement(oe,{value:"http"},"HTTP"))),n.createElement(F.a.Item,{label:"服务地址",name:"host",rules:[{required:!0,message:"请输入上游服务地址！"}]},n.createElement(x.a,{autoComplete:"off",placeholder:"请输入上游服务地址",spellCheck:"false"})),n.createElement(F.a.Item,{label:"请求类型",name:"method",rules:[{required:!0,message:"请设置上游服务请求类型！"}],initialValue:"GET"},n.createElement(R.a,null,n.createElement(oe,{value:"GET"},"GET"),n.createElement(oe,{value:"POST"},"POST"),n.createElement(oe,{value:"PUT"},"PUT"),n.createElement(oe,{value:"DELETE"},"DELETE"))),n.createElement(F.a.Item,{label:"端口",name:"port",rules:[{required:!0,message:"请设置上游服务的端口！"}],initialValue:80},n.createElement(P.a,null)),n.createElement(F.a.Item,{label:"路由地址",name:"upstream",rules:[{required:!0,message:"请设置上游服务的路由地址！"}]},n.createElement(x.a,{autoComplete:"off",placeholder:"请设置上游服务的路由地址",spellCheck:"false"})),n.createElement(M.a,{orientation:"left"},"扩展配置"),n.createElement(F.a.Item,{label:"身份校验",name:"auth_type",rules:[{required:!0,message:"请设置此接口的身份校验类型！"}],initialValue:0},n.createElement(R.a,null,n.createElement(oe,{value:0},"无鉴权"),n.createElement(oe,{value:1},"JWT鉴权"))))),n.createElement(le,{tab:"熔断/限流",key:"2",forceRender:!0},n.createElement(F.a,{labelCol:{span:4},wrapperCol:{span:18},ref:this.form2,onValuesChange:(e,t)=>{console.log(e,t),this.setState({limitFormConfig:t.rate_limit})}},n.createElement(F.a.Item,{label:"限流算法",name:"rate_limit",rules:[{required:!0,message:"请设置此接口的限流算法！"}],initialValue:0},n.createElement(R.a,null,n.createElement(oe,{value:0},"无"),n.createElement(oe,{value:2},"令牌桶"))),0!==this.state.limitFormConfig?n.createElement(M.a,{orientation:"left"},"选项"):null,2===this.state.limitFormConfig?n.createElement(F.a.Item,{label:"令牌速率",name:"token_rate",rules:[{required:!0,message:"请设置每秒生成令牌速率！"}],initialValue:1e4},n.createElement(P.a,null)):null,2===this.state.limitFormConfig?n.createElement(F.a.Item,{label:"令牌数量",name:"token_sum",rules:[{required:!0,message:"请设置总令牌数量！"}],initialValue:2e4},n.createElement(P.a,null)):null)),"edit"===this.props.type?n.createElement(le,{tab:"文档说明",key:"3",forceRender:!0,style:{position:"relative"}},this.state.editMarkdown?null:n.createElement(n.Fragment,null,n.createElement(X,{code:this.state.doc,className:L.a.markdown}),n.createElement("img",{src:ne,className:L.a.edit,onClick:()=>{this.setState({editMarkdown:!0})},alt:"编辑",title:"编辑"})),this.state.editMarkdown?n.createElement(n.Fragment,null,n.createElement(ae,{className:L.a.text,value:this.state.doc,onChange:e=>{this.setState({doc:e})}}),n.createElement("div",null,n.createElement("img",{src:se,className:L.a.ok,onClick:()=>{(async(e,t,a,n)=>{const s=await V.a.post(B+"/api/doc/update",{content:n,api_id:a},{headers:{token:e,uid:t}});return q(s.status),D(s.data)})(this.token,this.uid,this.props.api_id,this.state.doc).then(()=>{U(this.token,this.uid,this.props.api_id).then(e=>{this.setState({doc:e.doc,editMarkdown:!1})})})},alt:"确认",title:"确认"}),n.createElement("img",{src:re,className:L.a.cancel,onClick:()=>{this.setState({doc:this.state.initDoc,editMarkdown:!1})},alt:"取消",title:"取消"}))):null):null)))}}var me=ie(ce);const ue=(e,t,a)=>{if(!e||!t)return 0;const n=e.length>t.length?e.length:t.length,s=e.length,r=t.length,i=[];a=a||3;let o,l,c,m,u;if(0===s)return r;if(0===r)return s;for(o=0;o<=s;o++)i[o]=[],i[o][0]=o;for(l=0;l<=r;l++)i[0][l]=l;for(o=1;o<=s;o++)for(c=e.charAt(o-1),l=1;l<=r;l++)m=t.charAt(l-1),u=c===m?0:1,i[o][l]=(p=i[o-1][l]+1,h=i[o][l-1]+1,d=i[o-1][l-1]+u,p<h?p<d?p:d:h<d?h:d);var p,h,d;const g=1-i[s][r]/n;return parseFloat(g.toFixed(a))},pe=(e,t,a)=>{if(e.length<=1)return e;const n=Math.floor(e.length/2),s=e.splice(n,1)[0],r=[],i=[];for(let n=0;n<e.length;n++)"desc"===t&&(a?e[n][a]>s[a]?r.push(e[n]):i.push(e[n]):e[n]>s?r.push(e[n]):i.push(e[n])),"asc"===t&&(a?e[n][a]<s[a]?r.push(e[n]):i.push(e[n]):e[n]<s?r.push(e[n]):i.push(e[n]));return pe(r,t,a).concat([s],pe(i,t,a))},{withRouterConnect:he}=r.a,{Search:de}=x.a;class ge extends n.PureComponent{constructor(){super(...arguments),this.state={gatewayData:[],tableList:[],selectedRowKeys:[],gatewayConfigLoading:!1},this.token=this.props.state.global.token,this.uid=this.props.state.global.user_id,this.gatewayCol=[{title:"名称",dataIndex:"name",key:"name"},{title:"分类",dataIndex:"tag",key:"tag",render:e=>{const t=ge.stringToColor(e);return n.createElement(_.a,{color:t},e)}},{title:"类型",dataIndex:"method",key:"method"},{title:"对外路由",dataIndex:"prefix",key:"prefix"},{title:"上游服务",dataIndex:"upstream",key:"upstream",render:e=>n.createElement("a",{onClick:()=>{alert("显示上游服务的详情")}},e)},{title:"调用次数",dataIndex:"call",key:"call"},{title:"是否有效",dataIndex:"is_enabled",key:"is_enabled",render:(e,t)=>n.createElement(_.a,{color:e?"green":"volcano"},e?"运行中":"已关闭")},{title:"操作",key:"action",render:(e,t)=>n.createElement("span",{style:{display:"flex"}},n.createElement(me,{type:"edit",api_id:t.api_id,onSuccess:()=>{this.init_api_config()}},n.createElement("a",{style:{marginRight:16}},"详情")),t.is_enabled?n.createElement("a",{style:{marginRight:16},onClick:()=>{K(this.token,this.uid,!1,t.api_id).then(()=>this.init_api_config()).catch(()=>S.a.error("禁用接口失败"))}},"禁用"):n.createElement("a",{style:{marginRight:16},onClick:()=>{K(this.token,this.uid,!0,t.api_id).then(()=>this.init_api_config()).catch(()=>S.a.error("启用接口失败"))}},"启用"),n.createElement("a",{onClick:()=>{(async(e,t,a)=>{const n=await V.a.post(B+"/api/delete",{api_id:a},{headers:{token:e,uid:t}});return D(n.data)})(this.token,this.uid,t.api_id).then(()=>{S.a.success("删除接口成功"),this.init_api_config()}).catch(()=>S.a.error("删除接口失败"))}},"删除"))}]}static stringToColor(e){let t=0;for(let a=0;a<e.length;a++)t=e.charCodeAt(a)+((t<<5)-t);let a="#";for(let e=0;e<3;e++){a+=("00"+(t>>8*e&255).toString(16)).substr(-2)}return a}componentDidMount(){document.title="接口网关",this.init_api_config()}onSearch(e){if(""!==e){const t=this.state.gatewayData;let a=[];for(const n of t){const t=(ue(e.toLowerCase(),n.name.toLowerCase())+ue(e.toLowerCase(),n.tag.toLowerCase())+ue(e.toLowerCase(),n.method.toLowerCase())+ue(e.toLowerCase(),n.prefix.toLowerCase())+ue(e.toLowerCase(),n.upstream.toLowerCase()))/5;t>0&&a.push({sim:t,data:n})}a=pe(a,"desc","sim");const n=[];for(const e of a)n.push(e.data);this.setState({tableList:n})}else this.setState({tableList:this.state.gatewayData})}render(){return n.createElement(f,null,n.createElement("div",{className:L.a.topBorder},n.createElement(w.a,{message:`已选择 ${this.state.selectedRowKeys.length} 项，服务调用次数总计 0 次`,type:"info",showIcon:!0}),n.createElement("div",{style:{display:"flex",alignItems:"center"}},n.createElement("div",{style:{margin:10}},n.createElement(de,{onChange:e=>{const t=e.target.value;Object(ee.a)(500,this.onSearch(t))},allowClear:!0})),n.createElement(me,{type:"create",onSuccess:()=>{this.init_api_config()}},n.createElement(C.a,{style:{marginRight:10}},"新建接口")),n.createElement(C.a,{onClick:()=>{(async(e,t)=>(await V.a.post(B+"/gateway/restart",{},{headers:{token:e,uid:t}})).data)(this.token,this.uid).then(()=>{S.a.success("保存配置成功"),this.init_api_config()}).catch(()=>S.a.error("保存配置失败"))}},"保存配置"))),n.createElement("div",{className:L.a.border},n.createElement(v.a,{rowSelection:{onChange:e=>{this.setState({selectedRowKeys:e})},selectedRowKeys:this.state.selectedRowKeys},columns:this.gatewayCol,dataSource:this.state.tableList,loading:this.state.gatewayConfigLoading})))}init_api_config(){this.setState({gatewayConfigLoading:!0}),(async(e,t)=>{const a=await V.a.get(B+"/api/list",{headers:{token:e,uid:t}});return q(a.status),D(a.data)})(this.token,this.uid).then(e=>{if(e.api_list){const t=[];for(let a=e.api_list.length-1;a>=0;a--)t.push({key:a,api_id:e.api_list[a].api_id,name:e.api_list[a].name,tag:e.api_list[a].tag,method:e.api_list[a].method,prefix:e.api_list[a].prefix,upstream:e.api_list[a].upstream,call:"暂无统计！",is_enabled:1===e.api_list[a].is_enabled});this.setState({gatewayData:t,tableList:t,gatewayConfigLoading:!1})}else S.a.error("初始化接口配置信息失败"),this.setState({gatewayConfigLoading:!1})}).catch(()=>{S.a.error("获取接口配置信息失败"),this.setState({gatewayConfigLoading:!1})})}}var fe=he(ge);const{withRouterConnect:ye}=r.a;class Ee extends n.PureComponent{render(){return n.createElement("div",null,"Monitoring")}}var be=ye(Ee);const{SubMenu:ke}=l.a,{withRouterConnect:ve}=r.a;class _e extends n.PureComponent{constructor(){super(...arguments),this.state={collapsed:!1,menus:[{key:"dashboard",title:"Dashboard",icon:"icon-activity-outline",sub:[{key:"/main",title:"概览",path:"/main"},{key:"/main/monitoring",title:"监控",path:"/main/monitoring"}]},{key:"/main/gateway",title:"接口网关",icon:"icon-navigation--outline",path:"/main/gateway"}]},this.IconFont=Object(c.a)({scriptUrl:"//at.alicdn.com/t/font_1761874_57vjfcyo30h.js"})}render(){const e=this.IconFont;return n.createElement(f,{style:{backgroundColor:"#353333"}},n.createElement("div",{className:u.a.menu},n.createElement("div",{style:{padding:"20px 20px 0 20px"}},n.createElement("img",{src:y,className:u.a.logo,alt:"凯神科技"}),n.createElement("div",{style:{backgroundColor:"#434343",height:1,margin:"18px 0"}})),n.createElement(l.a,{defaultSelectedKeys:[this.props.location.pathname],defaultOpenKeys:["dashboard"],mode:"inline",theme:"dark",inlineCollapsed:this.state.collapsed,style:{backgroundColor:"#1f1f1f"}},this.state.menus.map(t=>t.sub?n.createElement(ke,{key:t.key,title:n.createElement("span",null,n.createElement(e,{type:t.icon}),n.createElement("span",null,t.title))},t.sub.map(e=>n.createElement(l.a.Item,{key:e.key,onClick:()=>{e.path&&this.props.history.push(e.path)}},e.title))):n.createElement(l.a.Item,{key:t.key,onClick:()=>{t.path&&this.props.history.push(t.path)}},n.createElement(e,{type:t.icon}),n.createElement("span",null,t.title))))),n.createElement("div",{className:u.a.right},n.createElement("div",{className:u.a.navBar}),n.createElement("div",{id:"application",className:u.a.content},n.createElement(o.Switch,null,n.createElement(o.Route,{path:""+this.props.match.url,exact:!0,component:k}),n.createElement(o.Route,{path:this.props.match.url+"/monitoring",component:be}),n.createElement(o.Route,{path:this.props.match.url+"/gateway",component:fe})))))}}var Ce=ve(_e),we=a(25),Se=a.n(we),xe=a(45),Ne=a.n(xe),Le=a(201),Ie=a.n(Le),Fe=a(433);var Re=n.memo(e=>{const[t,a]=Object(n.useState)(Ne.a.line),[s,r]=Object(n.useState)("normal"),[i,o]=Object(n.useState)(e.defaultValue||""),l=n.createRef();let c=e.type?e.type:"text";"email"===c&&(c="text"),Object(n.useEffect)(()=>{"password"===c&&l.current&&l.current.focus()},[]);const m=e.placeholder?e.placeholder:"",u=Object(ee.a)(100,t=>{if(e.onChange)if("email"===e.type)if(""===t)r("normal"),a(Ne.a.lineErrorToFocus);else{const n=Ie()(t);n?(r("normal"),a(Ne.a.lineErrorToFocus)):(r("error"),a(Ne.a.lineError)),e.onChange(t,n)}else e.onChange(t)});return n.createElement("div",{className:e.className,style:{position:"relative",height:40,...e.style}},n.createElement("div",{className:Ne.a.inputContainer},n.createElement("input",{className:Ne.a.input,placeholder:m,value:i,type:c,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false",onChange:e=>{o(e.target.value),u(e.target.value)},onKeyUp:t=>{13===t.keyCode&&e.onEnter&&e.onEnter()},onFocus:()=>{"normal"===s&&a(Ne.a.lineFocus)},onBlur:()=>{"normal"===s&&a(Ne.a.lineBlur)},ref:l}),n.createElement("div",{className:Ne.a.info},n.createElement(Fe.a,{style:{fontSize:18,color:"#595959"}}))),n.createElement("div",{className:t}))}),Me=a.p+"6f870c8d2f8ce34b7c70bd78c5b0604c.svg";const{withRouterConnect:Pe}=r.a;class Te extends n.PureComponent{constructor(){super(...arguments),this.state={step:"email",account:""},this.emailValue=this.state.account,this.emailConfirm=!1,this.password=""}componentDidMount(){document.title="登录"}render(){return n.createElement(f,{style:{backgroundImage:`url('${Me}')`,backgroundColor:"#262626"}},n.createElement("div",{className:Se.a.outer},n.createElement("div",{className:Se.a.middle},n.createElement("div",{className:Se.a.inner},n.createElement("img",{src:y,style:{width:142.8,height:21.3},alt:"凯神科技"}),"email"===this.state.step?n.createElement(()=>n.createElement(n.Fragment,null,n.createElement("div",{className:Se.a.title},"登录"),n.createElement("div",{className:Se.a.titleDescribe},"使用公司邮箱登录"),n.createElement(Re,{placeholder:"电子邮件",type:"email",defaultValue:this.state.account,onChange:(e,t)=>{this.emailValue=e,this.emailConfirm=!!t},onEnter:()=>{this.emailConfirm&&this.setState({account:this.emailValue,step:"password"})}}),n.createElement("div",{className:Se.a.prompt},"申请新的账号"),n.createElement("div",{className:Se.a.button,onClick:()=>{this.emailConfirm&&this.setState({account:this.emailValue,step:"password"})}},"下一步")),null):null,"password"===this.state.step?n.createElement(()=>n.createElement(n.Fragment,null,n.createElement("div",{className:Se.a.title},"输入密码"),n.createElement("div",{className:Se.a.titleContainer},n.createElement("div",{className:Se.a.titleDescribe,style:{color:"#faf9f5"}},this.state.account),n.createElement("div",{className:Se.a.chooseAccount,style:{marginLeft:10},onClick:()=>{this.emailConfirm=!0,this.setState({step:"email"})}},"使用其他账户")),n.createElement(Re,{placeholder:"输入密码",type:"password",onChange:e=>{this.password=e},onEnter:async()=>{try{await this.props.dispatch({type:"global/login",payload:{account:this.state.account,password:this.password}})}catch(e){return}this.props.history.push("/main")}}),n.createElement("div",{className:Se.a.prompt},"忘记密码?"),n.createElement("div",{className:Se.a.button,onClick:async()=>{try{await this.props.dispatch({type:"global/login",payload:{account:this.state.account,password:this.password}})}catch(e){return}this.props.history.push("/main")}},"登录")),null):null))))}}var je=Pe(Te),Oe={namespace:"global",state:{test:123,token:"",user_id:""},epics:{async test_async(e,t){try{t({type:"global/set_test_state",payload:{test:12345}})}catch(e){throw e}},async login(e,t){try{const{token:a,user_id:n}=await(async(e,t)=>{const a=await V.a.post(B+"/users/login/normal",{account:e,password:A(t),channel:"web"});return D(a.data)})(e.payload.account,e.payload.password);t({type:"global/set_token",payload:{token:a,user_id:n}})}catch(e){throw S.a.error(e.apiInfo),e}}},reducers:{set_token:(e,t)=>t.payload.token&&t.payload.user_id?{...e,token:t.payload.token,user_id:t.payload.user_id}:{...e}}};window.React=n,window.magic=r.a,r.a.addModel(Oe),r.a.start(n.createElement(i.a,null,n.createElement(o.Switch,null,n.createElement(o.Route,{path:"/",exact:!0,component:()=>(window.location.href="/login",null)}),n.createElement(o.Route,{path:"/main",component:Ce}),n.createElement(o.Route,{path:"/login",component:je}))),"dashboard",{persist:!0})},45:function(e,t,a){e.exports={inputContainer:"_2EXXrZF8Q0m_tqX3pcomic",input:"_12xEmwvYI3rUjQTQrZGe2I",info:"_1RqQLrJC_R6Qd4NSNyfI0r",line:"_3CKWeDkOLITEy-SPfNgVvg",lineWarn:"_1K3ewY_PEYlGy1CBXPOul5",error:"NpAjWvRfj8HRug4BValu6",lineErrorToFocus:"_1bNetbZBG3DsC7SEF-Cs04",errorToFocus:"_3lOpWFX7zgaexopeMktV6B",lineError:"_3ymVtdqV7APVvOexjGkp-R",lineFocus:"_3fS2i_72jfMEG5S9v0vPj_",focus:"_3lZPHC-y2JsK0SjX_8cRWx",lineBlur:"_2E6nRp6ACAzfRZn1nP8KOz",blur:"_2WjmQkiEDAYVe1LK54m9Wd",warn:"_19M-BRLYNG0YoWxwCywIgk"}},48:function(e,t,a){e.exports={border:"_2P4YEUwibtqWOQFLkWKVJB",topBorder:"aRvtaT1IPa9QHvLXCBkr1",markdown:"_20Vhi03Ql1VUs1Jw1cptR-",edit:"_3Au_vS8Oat5RHJmzUPkVjV",ok:"_2xyUaYvL-PZRnAwjkwEKfl",cancel:"_2zlk4oBUb0rFnycYPI3Yrq",text:"_2mLOuzr7mMJ6klVirZ8wxG"}},85:function(e,t,a){e.exports={logo:"_3WKQE71Zh8F3aeHeIRW009",menu:"LDNpeneDkZcAq7SuH9KoJ",right:"_17wqRsL2-EwFHp2p2Tx_MN",navBar:"lSfFKcl9qhOtoZP8Xajmo",content:"_3mK3jJqd8uNMUj1vnnZcM2"}}});